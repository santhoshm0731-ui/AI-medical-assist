{% extends 'base.html' %}
{% block title %}Pharmacy Orders{% endblock %}
{% block content %}

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="fw-bold text-primary">üì¶ Orders for {{ pharmacy.pharmacy_name }}</h3>
    <a href="{% url 'pharmacy_dashboard' %}" class="btn btn-outline-secondary btn-sm">
      ‚Üê Back to Dashboard
    </a>
  </div>

  {% if orders %}
    <table class="table table-striped text-center align-middle">
      <thead class="table-primary">
        <tr>
          <th>#</th>
          <th>Patient</th>
          <th>Medicine</th>
          <th>Qty</th>
          <th>Total</th>
          <th>Status</th>
          <th>Patient Confirmed</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for o in orders %}
        <tr>
          <td>{{ o.id }}</td>
          <td>{{ o.patient.username }}</td>
          <td>{{ o.medicine.name }}</td>
          <td>{{ o.quantity }}</td>
          <td>‚Çπ{{ o.total_price }}</td>
          <td>{{ o.get_status_display }}</td>
          <td>
            {% if o.patient_confirmed %}
              <span class="badge bg-success">Yes</span>
            {% else %}
              <span class="badge bg-secondary">No</span>
            {% endif %}
          </td>
          <td>
            {% if o.status == "PENDING" %}
              <form method="POST" action="{% url 'update_order_status' o.id 'accept' %}" style="display:inline;">
                {% csrf_token %}
                <button class="btn btn-sm btn-success">Accept</button>
              </form>
              <form method="POST" action="{% url 'update_order_status' o.id 'cancel' %}" style="display:inline;">
                {% csrf_token %}
                <button class="btn btn-sm btn-danger">Cancel</button>
              </form>

            {% elif o.status == "ACCEPTED" %}
              <form method="POST" action="{% url 'update_order_status' o.id 'out' %}" style="display:inline;">
                {% csrf_token %}
                <button class="btn btn-sm btn-primary">Out for delivery</button>
              </form>
              <form method="POST" action="{% url 'update_order_status' o.id 'cancel' %}" style="display:inline;">
                {% csrf_token %}
                <button class="btn btn-sm btn-danger">Cancel</button>
              </form>

            {% elif o.status == "OUT_FOR_DELIVERY" %}
              <form method="POST" action="{% url 'update_order_status' o.id 'delivered' %}" style="display:inline;">
                {% csrf_token %}
                <button class="btn btn-sm btn-success">Mark Delivered</button>
              </form>

            {% elif o.status == "DELIVERED" %}
              <span class="text-muted small">Waiting for patient confirmation‚Ä¶</span>

            {% else %}
              <span class="text-muted">‚Äî</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="alert alert-info text-center mt-4">
      No orders yet.
    </div>
  {% endif %}
</div>

{% endblock %}
